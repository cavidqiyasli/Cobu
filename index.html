<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>üí¨ Cobu Chat ‚Äî ≈û…ôxsi mesajla≈üma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      margin: 0;
      background: #121212;
      color: white;
      font-family: system-ui, sans-serif;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Sol panel ‚Äî profil ≈ü…ôkill…ôri */
    #users {
      width: 90px;
      background: #1e1e1e;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px 5px;
      overflow-y: auto;
      border-right: 1px solid #333;
    }

    .user {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      overflow: hidden;
      margin: 8px 0;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .user:hover { transform: scale(1.1); }

    .user img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
      border: 2px solid #444;
    }

    /* Saƒü t…ôr…ôf ‚Äî chat p…ônc…ôr…ôsi */
    #chatArea {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: #181818;
    }

    #header {
      padding: 10px;
      background: #222;
      border-bottom: 1px solid #333;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #header img {
      width: 35px;
      height: 35px;
      border-radius: 50%;
    }

    #messages {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
    }

    .msg {
      margin: 5px 0;
      padding: 8px 12px;
      border-radius: 12px;
      max-width: 75%;
    }

    .me {
      background: #0a84ff;
      align-self: flex-end;
      color: white;
    }

    .other {
      background: #333;
      align-self: flex-start;
      color: white;
    }

    #inputArea {
      display: flex;
      padding: 10px;
      background: #222;
    }

    #msgInput {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 8px;
      outline: none;
      background: #333;
      color: white;
    }

    #sendBtn {
      margin-left: 8px;
      background: #0a84ff;
      border: none;
      color: white;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    #authArea {
      position: absolute;
      top: 10px;
      right: 10px;
    }

    #loginBtn, #logoutBtn {
      background: #1976d2;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>

  <div id="users"></div>

  <div id="chatArea">
    <div id="header">
      <img id="chatPhoto" src="" alt="">
      <b id="chatName">He√ß kim se√ßilm…ôyib</b>
    </div>
    <div id="messages"></div>
    <div id="inputArea">
      <input id="msgInput" placeholder="Mesaj yaz..." />
      <button id="sendBtn">G√∂nd…ôr</button>
    </div>
  </div>

  <div id="authArea">
    <button id="loginBtn">Google il…ô daxil ol</button>
    <button id="logoutBtn" style="display:none;">√áƒ±xƒ±≈ü</button>
  </div>

<script>
  // üîπ Firebase qo≈üulmasƒ±
  const firebaseConfig = {
    apiKey: "AIzaSyDD0ZmMgCNh7ibhUTf8aKZ-Vd6xyDHBThU",
    authDomain: "cobu-chat-5dab7.firebaseapp.com",
    projectId: "cobu-chat-5dab7",
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // üîπ Server…ô qo≈üulma
  const socket = io("https://cobu.onrender.com");

  const usersDiv = document.getElementById("users");
  const chatName = document.getElementById("chatName");
  const chatPhoto = document.getElementById("chatPhoto");
  const messagesDiv = document.getElementById("messages");
  const msgInput = document.getElementById("msgInput");
  const sendBtn = document.getElementById("sendBtn");

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");

  let myId = null;
  let targetId = null;

  auth.onAuthStateChanged(user => {
    if (user) {
      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";
      socket.emit("registerUser", {
        name: user.displayName,
        email: user.email,
        photo: user.photoURL
      });
    } else {
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
    }
  });

  loginBtn.onclick = async () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    await auth.signInWithPopup(provider);
  };
  logoutBtn.onclick = () => auth.signOut();

  socket.on("connect", () => { myId = socket.id; });

  socket.on("userList", list => {
    usersDiv.innerHTML = "";
    for (let id in list) {
      if (id === socket.id) continue;
      const u = list[id];
      const div = document.createElement("div");
      div.className = "user";
      div.innerHTML = `<img src="${u.photo}" title="${u.name}">`;
      div.onclick = () => selectUser(id, u);
      usersDiv.appendChild(div);
    }
  });

  function selectUser(id, u) {
    targetId = id;
    chatName.textContent = u.name;
    chatPhoto.src = u.photo;
    messagesDiv.innerHTML = "";
  }

  sendBtn.onclick = () => sendMessage();
  msgInput.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });

  function sendMessage() {
    const text = msgInput.value.trim();
    if (!text || !targetId) return;
    socket.emit("privateMessage", { to: targetId, text });
    appendMessage("S…ôn", text, "me");
    msgInput.value = "";
  }

  socket.on("privateMessage", msg => {
    appendMessage(msg.name, msg.text, "other");
  });

  function appendMessage(sender, text, cls) {
    const div = document.createElement("div");
    div.className = "msg " + cls;
    div.textContent = `${sender}: ${text}`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }
</script>
</body>
</html>
