<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>ðŸ’¬ CanlÄ± YazÄ±ÅŸma (Google Login)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    *{box-sizing:border-box}
    body{background:#111;color:#fff;font-family:system-ui, sans-serif;display:flex;flex-direction:column;align-items:center;height:100vh;margin:0;padding:10px}
    #messages{flex:1;width:100%;max-width:600px;background:#222;border-radius:10px;padding:10px;overflow:auto;margin-bottom:10px}
    #inputArea{display:flex;width:100%;max-width:600px}
    input{flex:1;padding:12px;border-radius:10px 0 0 10px;border:none;outline:none}
    button{padding:12px;border-radius:0 10px 10px 0;border:none;background:#28a745;color:white;cursor:pointer}
    #userInfo{width:100%;max-width:600px;color:#ddd;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center}
    #loginBtn,#logoutBtn{background:#1976d2;color:white;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
  </style>

  <!-- Firebase kitabxanalarÄ± -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <!-- Socket.io -->
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
  <h2>ðŸ’¬ CanlÄ± YazÄ±ÅŸma â€” Google ilÉ™ daxil ol</h2>

  <div id="userInfo">
    <div id="who">GiriÅŸ olunmayÄ±b</div>
    <div>
      <button id="loginBtn">Google ilÉ™ daxil ol</button>
      <button id="logoutBtn" style="display:none">Ã‡Ä±xÄ±ÅŸ</button>
    </div>
  </div>

  <div id="messages"></div>

  <div id="inputArea">
    <input id="msgInput" type="text" placeholder="Mesaj yaz..." />
    <button onclick="sendMessage()">GÃ¶ndÉ™r</button>
  </div>

<script>
  // ðŸ”¹ SÉ™nin FIREBASE konfiqurasiyan
  const firebaseConfig = {
    apiKey: "AIzaSyDD0ZmMgCNh7ibhUTf8aKZ-Vd6xyDHBThU",
    authDomain: "cobu-chat-5dab7.firebaseapp.com",
    projectId: "cobu-chat-5dab7",
    storageBucket: "cobu-chat-5dab7.firebasestorage.app",
    messagingSenderId: "810986044461",
    appId: "1:810986044461:web:14816bc8f2733df7434ca4",
    measurementId: "G-5EJPW0XWMR"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // ðŸ”¹ SERVERÄ°N URL-i (Render linkin)
  const socket = io("https://cobu.onrender.com");

  const messagesDiv = document.getElementById("messages");
  const input = document.getElementById("msgInput");
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const who = document.getElementById("who");

  // ðŸ”¹ Ä°stifadÉ™Ã§i vÉ™ziyyÉ™ti dÉ™yiÅŸÉ™ndÉ™
  auth.onAuthStateChanged(user => {
    if (user) {
      who.textContent = `${user.displayName} (${user.email})`;
      loginBtn.style.display = "none";
      logoutBtn.style.display = "inline-block";
    } else {
      who.textContent = "GiriÅŸ olunmayÄ±b";
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
    }
  });

  // ðŸ”¹ Google ilÉ™ daxil ol
  loginBtn.onclick = async () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    try {
      await auth.signInWithPopup(provider);
    } catch (e) {
      alert("Daxil olma xÉ™tasÄ±: " + e.message);
    }
  };

  // ðŸ”¹ Ã‡Ä±xÄ±ÅŸ
  logoutBtn.onclick = () => auth.signOut();

  // ðŸ”¹ Yeni mesaj gÉ™ldikdÉ™
  socket.on("chatMessage", data => {
    const p = document.createElement("p");
    p.innerHTML = `<strong>${escapeHtml(data.name || data.email || "Anon")}</strong>: ${escapeHtml(data.text)} <small style="color:#999">${new Date(data.ts).toLocaleTimeString()}</small>`;
    messagesDiv.appendChild(p);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });

  // ðŸ”¹ Mesaj gÃ¶ndÉ™rmÉ™k
  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    const user = auth.currentUser;
    const payload = {
      text,
      ts: Date.now(),
      name: user ? user.displayName : null,
      email: user ? user.email : null
    };
    socket.emit("chatMessage", payload);
    input.value = "";
  }

  input.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });

  function escapeHtml(s){ 
    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]));
  }
</script>
</body>
</html>
